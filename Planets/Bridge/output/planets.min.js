(function(){"use strict";Bridge.define("Planets.App",{statics:{container:null,canvas:null,startPlanets:0,timLimitScale:0,timeScale:0,gScale:0,newPlanetSpeedScale:0,config:{init:function(){Bridge.ready(this.main)}},main:function(){var sky,ctx,timestamp;Planets.App.getContainerProperties();Planets.App.setupCanvas();sky=new Planets.Sky(Planets.App.container.clientWidth,Planets.App.container.clientHeight,Planets.App.timLimitScale,Planets.App.gScale,Planets.App.newPlanetSpeedScale,Planets.App.timeScale);sky.addRandomPlanets(Planets.App.startPlanets);ctx=Planets.App.canvas.getContext("2d");timestamp=Bridge.global.performance.now();window.requestAnimationFrame(function(t){Planets.App.renderFrame(sky,ctx,t,timestamp,!0)})},getContainerProperties:function(){var timLimitScale,timeScale,gScale,newPlanetSpeedScale;Planets.App.container=Bridge.cast(document.getElementById("planets-container"),HTMLDivElement);Planets.App.container.style.margin="0px";var startPlanetsStr=Planets.App.container.getAttribute("data-startPlanets"),timLimitScaleStr=Planets.App.container.getAttribute("data-timLimitScale"),timeScaleStr=Planets.App.container.getAttribute("data-timeScale"),gScaleStr=Planets.App.container.getAttribute("data-gScale"),newPlanetSpeedScaleStr=Planets.App.container.getAttribute("data-newPlanetSpeedScale"),startPlanets={v:0};System.Int32.tryParse(startPlanetsStr,startPlanets)||(startPlanets.v=Planets.Sky.dEFAULT_START_PLANETS);Planets.App.startPlanets=startPlanets.v;timLimitScale={v:0};System.Double.tryParse(timLimitScaleStr,null,timLimitScale)||(timLimitScale.v=1);Planets.App.timLimitScale=timLimitScale.v;timeScale={v:0};System.Double.tryParse(timeScaleStr,null,timeScale)||(timeScale.v=1);Planets.App.timeScale=timeScale.v;gScale={v:0};System.Double.tryParse(gScaleStr,null,gScale)||(gScale.v=1);Planets.App.gScale=gScale.v;newPlanetSpeedScale={v:0};System.Double.tryParse(newPlanetSpeedScaleStr,null,newPlanetSpeedScale)||(newPlanetSpeedScale.v=1);Planets.App.newPlanetSpeedScale=newPlanetSpeedScale.v},setupCanvas:function(){Planets.App.canvas=Bridge.cast(document.createElement("canvas"),HTMLCanvasElement);Planets.App.canvas.id="planet_canvas";Planets.App.canvas.width=Planets.App.container.clientWidth;Planets.App.canvas.height=Planets.App.container.clientHeight;Planets.App.canvas.style.width="100%";Planets.App.canvas.style.height="100%";Planets.App.canvas.style.backgroundColor="transparent";Planets.App.canvas.style.display="block";document.body.style.margin="0px";Planets.App.container.appendChild(Planets.App.canvas)},renderFrame:function(sky,ctx,currenttime,prevtime,recalc){var elapsedTime=currenttime-prevtime;elapsedTime%=100;sky.move(elapsedTime);Planets.App.redrawSky(ctx,sky);recalc&&sky.recalculateGravity(elapsedTime);window.requestAnimationFrame(function(t){Planets.App.renderFrame(sky,ctx,t,currenttime,!recalc)})},redrawSky:function(ctx,sky){var i,planet;for(ctx.clearRect(0,0,sky.xSize,sky.ySize),ctx.fillStyle="white",(Planets.App.canvas.width!==Planets.App.container.clientWidth||Planets.App.canvas.height!==Planets.App.container.clientHeight)&&(Planets.App.canvas.width=Planets.App.container.clientWidth,Planets.App.canvas.height=Planets.App.container.clientHeight,sky.xSize=Planets.App.canvas.width,sky.ySize=Planets.App.canvas.height),i=0;i<sky.planets.getCount();i=i+1|0)planet=sky.planets.get(i),ctx.beginPath(),ctx.arc(planet.x,planet.y,planet.radius,0,2*Math.PI),ctx.closePath(),ctx.fill()}},$entryPoint:!0});Bridge.define("Planets.Planet",{statics:{count:System.Int64(0)},id:System.Int64(0),x:0,y:0,size:0,xVel:0,yVel:0,futureXVel:0,futureYVel:0,radius:0,remove:!1,constructor:function(x,y,size,xVel,yVel){this.id=Planets.Planet.count;Planets.Planet.count=Planets.Planet.count.inc();this.x=x;this.y=y;this.size=size;this.xVel=xVel;this.yVel=yVel;this.futureXVel=xVel;this.futureYVel=yVel;this.radius=2*Math.sqrt(size/1e3/Math.PI);this.remove=!1}});Bridge.define("Planets.Sky",{statics:{dEFAULT_TIM_LIMIT:512e5,dEFAULT_START_PLANETS:100,dEFAULT_G:.0053392640000000007},g:0,timLimit:0,newPlanetSpeedScale:0,timeScale:0,xSize:0,ySize:0,planets:null,constructor:function(xSize,ySize,timLimitScale,gScale,newPlanetSpeedScale,timeScale){this.xSize=xSize;this.ySize=ySize;this.timLimit=timLimitScale*Planets.Sky.dEFAULT_TIM_LIMIT;this.g=Planets.Sky.dEFAULT_G*gScale;this.newPlanetSpeedScale=newPlanetSpeedScale;this.timeScale=timeScale;this.planets=new System.Collections.Generic.List$1(Planets.Planet)()},addRandomPlanets:function(numPlanets){for(var i=0;i<numPlanets;i=i+1|0){var x=Math.random()*this.xSize,y=Math.random()*this.ySize,xVel=Math.random()*10-5,yVel=Math.random()*10-5,newPlanet=new Planets.Planet(x,y,5e4,xVel,yVel);this.addPlanet(newPlanet)}},recalculateGravity:function(elapsedTime){for(var planet,j,otherPlanet,k,force,index,planet1,i=0;i<this.planets.getCount();i=i+1|0)if(planet=this.planets.get(i),!planet.remove)for(planet.futureXVel=planet.xVel,planet.futureYVel=planet.yVel,j=0;j<this.planets.getCount();j=j+1|0)if(otherPlanet=this.planets.get(j),!otherPlanet.remove&&!planet.remove&&otherPlanet.id.ne(planet.id)){var xDistance=otherPlanet.x-planet.x,yDistance=otherPlanet.y-planet.y,totalDistanceSquared=xDistance*xDistance+yDistance*yDistance,totalDistance=Math.sqrt(totalDistanceSquared);if(totalDistance<planet.radius+otherPlanet.radius){var xInwardKE=planet.size*planet.xVel*Math.abs(planet.xVel)-otherPlanet.size*otherPlanet.xVel*Math.abs(otherPlanet.xVel),yInwardKE=planet.size*planet.yVel*Math.abs(planet.yVel)-otherPlanet.size*otherPlanet.yVel*Math.abs(otherPlanet.yVel),totalInwardKE=Math.sqrt(xInwardKE*xInwardKE+yInwardKE*yInwardKE),newX=(planet.size*planet.x+otherPlanet.size*otherPlanet.x)/(planet.size+otherPlanet.size),newY=(planet.size*planet.y+otherPlanet.size*otherPlanet.y)/(planet.size+otherPlanet.size);if(totalInwardKE>this.timLimit){var totalSize=planet.size+otherPlanet.size,averageXVel=(planet.size*planet.xVel+otherPlanet.size*otherPlanet.xVel)/totalSize,averageYVel=(planet.size*planet.yVel+otherPlanet.size*otherPlanet.yVel)/totalSize,numPlanets=Bridge.Int.clip32((planet.size+otherPlanet.size)/5e4);numPlanets>20&&(numPlanets=20);var newSize=totalSize/numPlanets,newVel=Math.sqrt(this.g*(planet.size+otherPlanet.size))/10*this.newPlanetSpeedScale,newRadius=Math.sqrt(planet.size/1e3/Math.PI),explosionRadius=1.1*newRadius*numPlanets/Math.PI,angle=2*Math.PI/numPlanets,currentAngle=Math.PI*Math.random();for(k=0;k<numPlanets;k=k+1|0)this.addPlanet(new Planets.Planet(newX+explosionRadius*Math.cos(currentAngle),newY+explosionRadius*Math.sin(currentAngle),newSize,averageXVel+newVel*Math.cos(currentAngle),averageYVel+newVel*Math.sin(currentAngle))),currentAngle+=angle}else this.combine(planet,otherPlanet);planet.remove=!0;otherPlanet.remove=!0}else force=this.g*planet.size*otherPlanet.size/totalDistanceSquared,planet.xVel=planet.xVel+force/planet.size*xDistance/totalDistance*elapsedTime/16,planet.yVel=planet.yVel+force/planet.size*yDistance/totalDistance*elapsedTime/16}for(index=0;index<this.planets.getCount();)planet1=this.planets.get(index),planet1.remove?this.planets.removeAt(index):index=index+1|0},move:function(elapsedTime){for(var planet,i=0;i<this.planets.getCount();i=i+1|0){for(planet=this.planets.get(i),planet.x+=planet.xVel*elapsedTime/16*this.timeScale,planet.y+=planet.yVel*elapsedTime/16*this.timeScale,planet.x%=this.xSize,planet.y%=this.ySize;planet.x<0;)planet.x+=this.xSize;while(planet.y<0)planet.y+=this.ySize}},combine:function(planet1,planet2){var newSize=planet1.size+planet2.size,newX=(planet1.size*planet1.x+planet2.size*planet2.x)/newSize,newY=(planet1.size*planet1.y+planet2.size*planet2.y)/newSize,newXVel=(planet1.size*planet1.xVel+planet2.size*planet2.xVel)/newSize,newYVel=(planet1.size*planet1.yVel+planet2.size*planet2.yVel)/newSize;this.addPlanet(new Planets.Planet(newX,newY,newSize,newXVel,newYVel))},addPlanets:function(planetsToAdd){for(var i=0;i<planetsToAdd.getCount();i=i+1|0)this.addPlanet(planetsToAdd.get(i))},addPlanet:function(newPlanet){this.planets.add(newPlanet)}});Bridge.init()})(this);